名字：中间系统到中间系统
使用SPF算法[[OSPF#^a4dbf3|与OSPF相同]]，基于OSI七层模型开发的协议
ISIS是一种LS型协议，使用NSAP地址
#### ISIS路由器等级和角色
Level 1：只维护L1的LSDB
Level 2：只维护L2的LSDB
Level 1-2：默认，既是L1设备，也是L2设备；同时维护L1和L2的LSDB

|            | L1         | L2        | L1-2        |
| ---------- | ---------- | --------- | ----------- |
| 同区域的L1设备   | 只建立L1的邻居关系 | 不建立关系     | 只建立L1的邻居关系  |
| 跨区域的L1设备   | 不建立关系      | 不建立关系     | 不建立关系       |
| 同区域的L2设备   | 不建立关系      | 只建立L2邻居关系 | 只建立L2邻居关系   |
| 跨区域的L2设备   | 不建立关系      | 只建立L2邻居关系 | 只建立L2邻居关系   |
| 同区域的L1-2设备 | 只建立L1的邻居关系 | 只建立L2邻居关系 | 建立L1和L2邻居关系 |
| 跨区域的L1-2设备 | 不建立关系      | 只建立L2邻居关系 | 只建立L2邻居关系   |
L1和L2是无法互通的
L1组成的区域类似于OSPF的[[OSPF#^fa10cb|末节]]，域内
L2组成的区域是在域间
#### ISIS的报文类型
总共4类9种
1. IIH(ISIS Hello)，类似OSPF的[[OSPF#^157870|到达Hello包]]
   其中分为3种：L1 IIH, L2 IIH, P2P IIH
   ![[Pasted image 20240703231210.png]]
2. LSP（链路状态PDU）
   分为L1 LSP,L2 LSP两种；类似于OSPF中的[[OSPF#LSA类型|LSA]]，但LSP是独立的报文。
   ![[Pasted image 20240703231255.png]]
3. CSNP（完全序列号报文）
   分为L1 CSNP, L2 CSNP，承载了LSDB中所有LSP摘要；类似于OSPF中的[[OSPF#^93bfc5|DD报文]]
   ![[Pasted image 20240703232440.png]]
4. PSNP（部分序列号报文）
   分为L1 PSNP, L2 PSNP，用于请求更新和收到确认，类似于OSPF中的[[OSPF#^3e71f2|LSR和LSACK]]
   ![[Pasted image 20240703235004.png]]
   
#### ISIS邻居状态机
##### 邻居状态建立的过程：
在MA网络中，CSNP会每隔10s周期性洪泛，确保LSDB同步
在P2P网络中，CSNP只会在初期阶段发送一次
##### ISIS区域
ISIS的区域以路由器本身为单位划分区域，[[OSPF#OSPF的区域|区别于OSPF的区域划分]]
其中的骨干区域和非骨干区域是逻辑概念，而[[OSPF#OSPF的区域|OSPF的区域是实体概念]]
骨干区域是所有连续的L2设备和L1-2设备构成，非骨干区域由L1设备构成
##### ISIS的LSP
lsdb表![[Pasted image 20240708201438.png]]![[Pasted image 20240708195446.png]]
一条LSP的详细内容![[Pasted image 20240708201654.png]]
1. LSPID：用来表示一条LSP
   由这些部分组成：system-ID (6字节) + 伪节点ID (1字节，普通的LSP 00，伪节点LSP 非0) + 分片号 (1字节，如果不是00，代表LSP太大，需要分片)
   带星号表示这条LSP是由本设备产生的
2. Seq Num：序列号，代表一条LSP的新旧程度
3. ATT：关联位，一台L1-2设备有跨区域L2邻居时，会置ATT为1，向同区域L1设备通告一条默认路由
   L1设备可以与其他区域设备通信
4. P：修复特性
5. OL：overload，过载位，当OL为1时，代表设备能力超载，没有空闲资源可以传递路由，但是可以通告自己的直连路由。

#### DIS--指定中间系统
一般没有备份DIS；为了加快DIS选举和收敛，DIS的Hello时间设置成1/3，普通设备为3s
##### 伪节点
原先ISIS设备需要在其洪泛的LSP中描述所有的邻居关系，邻居数量越多，LSP就越大
伪节点可以解决这个问题，ISIS设备只要在LSP中描述与伪节点的邻居关系，伪节点LSP则描述伪节点与所有设备(包括DIS)的邻居关系，ISIS设备就能根据伪节点LSP计算出该LAN内的拓扑。
DIS负责生成伪节点LSP，类似于OSPF的2类LSA。
减少了网络中洪泛的LSP的体积，拓扑发生变化时，洪泛的LSP数量也会减少
##### 选举DIS的规则
1. 比较优先级：默认64（0-127），比大，优先级为0也能参与选举
2. 比较接口MAC地址，比大
DIS具备抢占，不会减少邻居关系，ISIS只有邻居一种关系
[[OSPF#路由器优先级|与OSPF的区别>>>]]
#### ISIS优化技术
1. 路由渗透：也可以说是路由引入，将L2路由引入L1中，让L1可以学习到其他区域的明细路由
2. 路由汇总：手工汇总，默认以L2形式发送，有时需要手动修改
3. 静默接口：不接受和发送ISIS报文，只宣告路由，环回口不支持，在接口下配置
4. 下发默认路由：自动添加always，，默认是L2形式下发
5. BFD：双向链路检测，可与多项技术联动(如OSPF，Vrrp，bgp等)，检测双方直连接口的
   与isis联动可使收敛速度提升
   BFD分为静态和动态
   1. 静态BFD：人为可控，可以在指定链路上配置，但是缺乏灵活性
   2. 动态BFD：灵活，开启ISIS设备所有接口的bfd，无法指定特定的链路
#### ISIS认证
接口认证：邻居合法性认证
区域认证：针对L1路由的学习
域认证：针对L2路由的学习
#### 开销计量方式
Narrow：窄，默认方式，开销值范围1-63
Wide：宽，开销值范围1-1777615
#### 权重下一跳
weight值越小越优（1-254，默认255）
