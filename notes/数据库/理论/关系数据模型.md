#数据库 
### 数据模型

1. 数据结构：物理数据模型，在数据库中称为概念模型。
2. 数据操作：在数据上的任何处理都可以称为数据操作。
3. 数据上的约束：在数据库系统中，数据模型通常有一种方法来描述数据上的约束。

### 关系模型

| title              | year | length | genre |
| ------------------ | ---- | ------ | ----- |
| Gone With the Wind | 1939 | 231    | drama |
| Star Wars          | 1977 | 124    | sciFi |
| Wayne's World      | 1992 | 95     | comdy |

#### 属性


关系的列命名为**属性**（字段），用来描述所在列的项目的语义

关系的属性次序可以相互调整。


#### 模式
关系名和其属性的组合称为这个关系的**模式**。关系名和圆括号括起来的属性

Movies关系模式：**Movies(title, year, length, genre)**

数据库的关系模式集合称为**关系数据库模式**或**数据库模式**。


#### 元组


关系中除含有属性名所在的行以外的其他行称为**元组**。

单独表示一个元组：**(Gone With the Wind ,1939 ,231 ,drama)** 用逗号隔开


#### 关系和属性的约定


用单独一个大写字母来表示关系和属性  **R(A,B,C)** 表示一个具有三个属性的关系


#### 域


关系模型要求元组的每个分量具有原子性，它必须属于某种元素类型，如integer或string

关系中任一元组的分量值必须属于对应列的域


#### 关系实例


一个给定关系中元组的集合叫做**关系的实例**。


#### 关系上的键

键由**一组属性集**组成。

主键是表的唯一标识。

在形成键的属性或属性组下面画上下划线，用来表明它是键的组成部分。

**Movies( *title ,year ,length ,genre )**

形成键的属性集的值对于关系的所以实例都具有唯一性。

#### SQL中的关系


1. 存储的关系，称为表
2. 视图，**视图只能看，表可以做修改**
3. 临时表


#### 修改关系模式


删除某个关系：**DROP TABLE**

delete和drop的区别：delete是删除表，drop是一点点删除。

修改关系：ALTER TABLE


### 代数查询语言

 #### 关系代数概述


通常的关系操作：**并、交、差**。

**选择** 是消除某些行（元组）的操作，**投影** 是消除某些列的操作。

笛卡儿积运算：两个关系的所有可能的元组的配对方式。

---

R∪S，表示关系R和S的并。

R∩S，表示关系R和S的交。

R−S，表示关系R和S的差。


#### 投影


投影用来从关系R生成一个新的关系，这个关系只包含原来关系R中的部分列。

符号：pai

在关系代数集合中，重复元组总是会被排除。（相同的合并，投影能去重）


#### 选择

应用到关系R上时，产生一个关系R的元组的子集合。结果关系的元组必须满足某个涉及R中属性的条件C   这个操作表示为


σC(R)\sigma_{C}(R) σ​C​​(R)


在Movies表中查询length大于等于100且studioName是Fox的元组：
```sql
σlength≥100ANDstudioName=′Fox′(Movies)\sigma_{length\geq100 ANDstudioName='Fox'}(Movies) σ​length≥100ANDstudioName=​′​​Fox​′​​​​(Movies)
```



#### 笛卡儿积


关系R和S的笛卡儿积是一个有序对的集合，有序对的第一个元素是关系R中的任何一个元组，第二个元素是关系S中的任何一个元组，表示为R*S，产生更长的元组，并且包含了R和S中的所有属性。


#### 自然连接


仅仅把在R和S模式中有某共同属性，且此属性有相同的值的元组配对。

把r和s连接作为R⋈S结果的元组，则这个元组被称为**连接元组**。连接元组具有R和S连接的所有成分。

在一个连接中，如果一个元组不能和另外关系中的任何一个元组配对的话，这个元组就被称为**悬浮元组**。


#### ɵ连接


有时需要将满足其他条件的元组配对，就有了ɵ连接，现在一般用C。

关系R和关系S满足条件C的ɵ连接可以这样用符号来表示：**R⋈*****c*****S**。操作的结果是1.先得到R和S的积，2.在得到的关系中寻找满足条件C的元组。

自然连接是最特殊的ɵ连接。


#### 组合操作构成查询


关系代数允许任意复杂的表达式，其操作符可以用于任何关系之上，这个关系既可以是某个给定关系，也可以是操作得到的结果关系。

可以在子表达式上应用算符来构造新的关系代数表达式，必要的时候用括号把操作数分开。

---

1.选择length大于等于100分钟的movies关系中的元组

2.选择studioName='Fox'的movies元组

3.计算1和2两个查询结果的交集。

4.把3的关系投影到title和year属性上

公式如下:


πtitle,year(σlength≥100(Movies)∩σstudioName=′Fox′(Movies))\pi_{title,year}(\sigma_{length\geq100}(Movies)\cap\sigma_{studioName='Fox'}(Movies)) π​title,year​​(σ​length≥100​​(Movies)∩σ​studioName=​′​​Fox​′​​​​(Movies))


或者使用AND：


πtitle,year(σlength≥100ANDstudioName=′Fox′(Movies))\pi_{title,year}(\sigma_{length\geq100ANDstudioName='Fox'}(Movies)) π​title,year​​(σ​length≥100ANDstudioName=​′​​Fox​′​​​​(Movies))

\pi_{需要选择的字段}(\sigma_{条件}(A表自然连接B表))

#### 命名和重命名


简单的重命名：


ρs(R)\rho_{s}(R) ρ​s​​(R)

\rho_{改动后的表名}(重命名后的名字)(原表名)

#### 操作之间的联系

R∩S=R−(R−S)R\cap S=R-(R-S) R∩S=R−(R−S)


左式：R交S，剩下的是R和S相同的部分，右式：R-S是R中有但S中没有的部分，R-（S中没有的部分），剩下R和S相同的部分。


R⋈cS=σc(R×S)R\bowtie cS=\sigma_{c}(R\times S) R⋈cS=σ​c​​(R×S)


左式：R和S中满足条件C的ɵ连接，右式：在R和S的所有可能性中选择出所有满足条件C的


R⋈S=πL(σC(R×S))R\bowtie S = \pi_{L}(\sigma_{C}(R\times S)) R⋈S=π​L​​(σ​C​​(R×S))


L是所有R中的属性和在S中但不在R中的属性列表。（R和S不同的部分)

左式：R和S自然连接，右式：在R和S的所有可能性中选择满足条件C的元组，投影出这些元组中R和S不同的部分。

### 关系上的约束

#### 作为约束语言的关系代数


1. 如果R是关系代数表达式，那么R=∅表示“R的值必须为空”的约束。（R中没有元组）
2. 如果R和S是关系代数表达式，那么R⊆S表示“任何在R中出现的元组都必须在S中出现的约束”。（R是S的子集）

所以R⊆S也是R-S=∅


#### 引用完整性约束


引用完整性约束是一种普通的约束。


用关系代数将引用完整性约束表述为\pi_{A}(R)-\pi_{B}(S),或写成\pi_{A}(R)-\pi_{B}(S)=∅

#### 键约束


没有任何两个元组在分量xxx上有相同的值。

“两个元组”在键name上相同，这“两个元组”必然是同一个。和自己作笛卡儿积（需要重命名），再变量每个新元组，选出其中name值相同但address值不同的元组。结果为∅。

证明主键是主键的方法：$\sigma_{MS1.name=MS2.nameAndMS1.address\neq MS2.address}(MS1\times MS2)=∅$

当只有一张表时，必然用$\rho$
